# 项目进展：MySQL-To-Excel 数据导出工具 (初始化状态)

## 已实现功能 (基于代码分析)

-   **配置加载**: 能够从 `config.toml` 读取数据库连接信息 (`host`, `port`, `user`, `password`, `db_name`) 和查询参数 (`sql`, `page_size`)。
-   **数据库连接**: 使用 `mysql_async` 建立到 MySQL 数据库的异步连接池。
-   **总行数统计**: 能够执行 `SELECT COUNT(*)` 查询来获取目标 SQL 查询的总行数。
-   **列名获取**: 能够执行查询并提取结果集的列名。
-   **分页查询**: 实现基于 `LIMIT` 和 `OFFSET` 的分页逻辑，循环获取数据。
-   **数据类型转换**: 包含一个 `convert_value_to_string` 函数，尝试将多种 MySQL `Value` 类型转换为字符串。
-   **Excel 文件创建**: 使用 `rust_xlsxwriter` 创建一个新的 `.xlsx` 工作簿和工作表。
-   **Excel 数据写入**:
    -   将列名写入 Excel 的第一行。
    -   将查询到的数据行（转换为字符串后）逐行写入 Excel。
-   **进度条显示**: 使用 `indicatif` 显示导出进度，包括已处理行数、总行数、百分比和当前页码信息。
-   **文件保存**: 将生成的 Excel 工作簿保存为 `data.xlsx` 到可执行文件所在的目录。
-   **基本错误处理**: 使用 `anyhow` 捕获和返回 Result，覆盖了配置加载、数据库操作和文件写入等环节可能出现的错误。

## 待办事项 / 潜在改进

-   **更健壮的数据类型处理**: `convert_value_to_string` 目前对所有类型都转换为字符串。对于数字和日期类型，直接写入 Excel 的相应类型可能更好（`rust_xlsxwriter` 支持 `write_number`, `write_datetime` 等）。
-   **错误处理细化**:
    -   可以为特定错误提供更友好的用户提示（例如，配置文件找不到、数据库连接失败、SQL 语法错误）。
    -   考虑添加重试逻辑，特别是在网络不稳定的情况下。
-   **配置验证**: 可以在加载配置后添加验证逻辑（例如，检查 `page_size` 是否为正数）。
-   **SQL 安全性**: 当前直接将用户提供的 SQL 拼接到 `COUNT(*)` 和分页查询中。虽然主要风险在于用户提供的 SQL 本身，但没有额外的防注入措施（依赖于用户提供合法的查询）。
-   **列名获取优化**: 当前获取列名的方式是执行一次完整的查询 (`conn.query_iter(&config.query.sql).await?`)。如果查询非常耗时或返回大量数据，这可能效率低下。可以考虑使用 `LIMIT 1` 或数据库特定的元数据查询来仅获取列名。
-   **内存使用监控/优化**: 虽然分页避免了加载整个结果集，但如果单行数据非常大或 `page_size` 设置不当，仍需关注内存使用。
-   **命令行参数**: 可以考虑添加命令行参数来覆盖部分配置，或指定输入/输出文件路径。
-   **测试**: 项目目前缺少自动化测试（单元测试、集成测试）。
-   **文档完善**: `README.md` 提供了基本用法，但可以补充更多细节，如错误代码说明、性能调优建议等。

## 当前状态

-   项目代码 (`src/main.rs`) 包含了一个完整的功能实现，可以执行从 MySQL 到 Excel 的基本导出流程。
-   核心功能（配置、连接、分页、写入、进度）均已实现。
-   项目处于可编译、可运行状态（假设环境配置正确）。

## 已知问题 (基于代码分析)

-   如“潜在改进”中提到的，数据类型处理可能不够理想（全部转为字符串）。
-   列名获取可能效率不高。
-   配置文件中的密码是明文存储。
